<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <title>Golang channel åŸç†ä»‹ç» | å°è´ºçš„åšå®¢</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="é—®é¢˜ ğŸ”— ä»å…³é—­çš„ channel è¯»å–æ•°æ®ï¼Œå¦‚ä»¥ä¸‹æƒ…å†µè¾“å‡ºä»€ä¹ˆã€‚å¦‚æœæ˜¯å‘é€æ•°æ®ï¼Œå†å…³é—­ä¸€æ¬¡ channelçš„æ“ä½œå‘¢ï¼Ÿæ€ä¹ˆåˆ¤æ–­ channel çš„æ˜¯å¦å…³é—­  func main() { ch := make(chan int,2) ch &lt;- 1 close(ch) num1, ok1 := &lt;- ch num2,ok2 := &lt;- ch println(num1,ok1) println(num2,ok2) } channel åº•å±‚å®ç° æ— ç¼“å†² channel ä¸æœ‰ç¼“å­˜ channel åŒºåˆ« channel VS mutex  channel ç®€ä»‹ ğŸ”— Do not communicate by sharing memory; instead, share memory by communicating.
 ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å®ç°å†…å­˜å…±äº«ã€‚è¿™æ˜¯ CSPï¼ˆCommunicating Sequential Processesï¼‰çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯ Go å¹¶å‘è®¾è®¡ä¸Šçš„å“²å­¦ã€‚CSP è®¤ä¸ºå¦‚æœç¼–ç¨‹è¯­è¨€ä¸­æŠŠä¾§é‡ç‚¹æ”¾åœ¨ processes é—´çš„é€šä¿¡ï¼Œé‚£ä¹ˆå¹¶å‘ç¼–ç¨‹ä¼šå˜å¾—å¾ˆç®€å•ï¼Œè€Œ Go ä¸­ channel å°±æ˜¯é€šä¿¡å®ä½“çš„å®ç°ï¼Œå¯ä»¥çœ‹ä½œæˆä¸€ä¸ªåç¨‹é—´çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚">
<meta name="generator" content="Hugo 0.89.2" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/xiaohe-blog/css/style.css">



<link rel="shortcut icon" href="/xiaohe-blog/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-FY1WNXTY3L', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/xiaohe-blog/"> <span class="arrow">â†</span>é¦–é¡µ</a>
	
	<a href="/xiaohe-blog/posts">å½’æ¡£</a>
	<a href="/xiaohe-blog/tags">æ ‡ç­¾</a>
	<a href="/xiaohe-blog/about">å…³äº</a>

	
		<a href="/xiaohe-blog/%e7%ae%97%e6%b3%95">ç®—æ³•</a>
	
		<a href="/xiaohe-blog/%e6%9d%82%e8%b0%88">æ‚è°ˆ</a>
	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Golang channel åŸç†ä»‹ç»</h1>

    <div class="tip">
      <div>2021å¹´11æœˆ29æ—¥</div>
        <span class="split">
          Â·
        </span>
        <span>
          864å­—
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          5åˆ†é’Ÿ è¯»å®Œ
        </span>
        <div class="views">
          <span class="views">
              <img src="https://visitor-badge.glitch.me/badge?page_id=https%3a%2f%2fhe2121.github.io%2fxiaohe-blog%2fposts%2fgolang%2fgolang-channel-%25E4%25BB%258B%25E7%25BB%258D%2f" alt="Views"/>
          </span>
      </div>
    </div>

    
    


    <div class="content">
      <h3 id="é—®é¢˜">é—®é¢˜ <a href="#%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—</a></h3><ol>
<li>ä»å…³é—­çš„ channel è¯»å–æ•°æ®ï¼Œå¦‚ä»¥ä¸‹æƒ…å†µè¾“å‡ºä»€ä¹ˆã€‚å¦‚æœæ˜¯å‘é€æ•°æ®ï¼Œå†å…³é—­ä¸€æ¬¡ channelçš„æ“ä½œå‘¢ï¼Ÿæ€ä¹ˆåˆ¤æ–­ channel çš„æ˜¯å¦å…³é—­</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">ch</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>,<span style="color:#ae81ff">2</span>)
	<span style="color:#a6e22e">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>
	close(<span style="color:#a6e22e">ch</span>)
	<span style="color:#a6e22e">num1</span>, <span style="color:#a6e22e">ok1</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ch</span>
	<span style="color:#a6e22e">num2</span>,<span style="color:#a6e22e">ok2</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ch</span>
	println(<span style="color:#a6e22e">num1</span>,<span style="color:#a6e22e">ok1</span>)
	println(<span style="color:#a6e22e">num2</span>,<span style="color:#a6e22e">ok2</span>)
}
</code></pre></div><ol start="2">
<li>channel åº•å±‚å®ç°</li>
<li>æ— ç¼“å†² channel ä¸æœ‰ç¼“å­˜ channel åŒºåˆ«</li>
<li>channel VS mutex</li>
</ol>
<h2 id="channel-ç®€ä»‹">channel ç®€ä»‹ <a href="#channel-%e7%ae%80%e4%bb%8b" class="anchor">ğŸ”—</a></h2><blockquote>
<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>
</blockquote>
<p>ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å®ç°å†…å­˜å…±äº«ã€‚è¿™æ˜¯ CSPï¼ˆCommunicating Sequential Processesï¼‰çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯ Go å¹¶å‘è®¾è®¡ä¸Šçš„å“²å­¦ã€‚CSP è®¤ä¸ºå¦‚æœç¼–ç¨‹è¯­è¨€ä¸­æŠŠä¾§é‡ç‚¹æ”¾åœ¨ processes é—´çš„é€šä¿¡ï¼Œé‚£ä¹ˆå¹¶å‘ç¼–ç¨‹ä¼šå˜å¾—å¾ˆç®€å•ï¼Œè€Œ Go ä¸­ channel å°±æ˜¯é€šä¿¡å®ä½“çš„å®ç°ï¼Œå¯ä»¥çœ‹ä½œæˆä¸€ä¸ªåç¨‹é—´çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<h2 id="channel-ä½¿ç”¨">channel ä½¿ç”¨ <a href="#channel-%e4%bd%bf%e7%94%a8" class="anchor">ğŸ”—</a></h2><p>å¯¹ channel çš„æ“ä½œæœ‰å››ç§ï¼š</p>
<ul>
<li>åˆ›å»º channelï¼š<code>ch := make(chan int)</code> <code>ch:=make(chan string, 10) </code></li>
<li>å‘ channel å‘é€æ¶ˆæ¯: <code>ch &lt;- num</code></li>
<li>ä» channel æ¥å—æ¶ˆæ¯: <code>num &lt;- ch</code>, <code>num, ok := &lt;- ch</code></li>
<li>å…³é—­ channel: <code>close(ch)</code>
ä¸€äº›å¯¹ channel æ“ä½œå¯èƒ½å‡ºç°çš„ä¸€äº›è¾¹ç•Œæ¡ä»¶æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­ full channel ä¸ empty channel åœ¨æ— ç¼“å†²å’Œæœ‰ç¼“å†² channel ä¸‹eçš„æ¦‚å¿µç¨æœ‰ä¸åŒï¼Œåœ¨ä¸‹æ–‡ä¸­è§£é‡Š</li>
</ul>
<p><p class="markdown-image">
  <img src="http://ganghuan.oss-cn-shenzhen.aliyuncs.com/img/mermaid-diagram-20211130225330-2021-11-30.png" alt="mermaid-diagram-20211130225330"  />
</p></p>
<h2 id="channel-å®ç°">channel å®ç° <a href="#channel-%e5%ae%9e%e7%8e%b0" class="anchor">ğŸ”—</a></h2><h3 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„ <a href="#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>channel çš„åº•å±‚æ•°æ®ç»“æ„å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œä¸ªäººè®¤ä¸ºä¸»è¦ç”±<strong>ä¸€ä¸ª buf æ•°ç»„ + 2 ä¸ª goroutine é“¾è¡¨</strong>ç»„æˆ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// src/runtime/chan.go
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">hchan</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">qcount</span>   <span style="color:#66d9ef">uint</span>           <span style="color:#75715e">// chan ä¸­å…ƒç´ ä¸ªæ•°
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">dataqsiz</span> <span style="color:#66d9ef">uint</span>           <span style="color:#75715e">// chan åº•å±‚å¾ªç¯é˜Ÿåˆ—çš„é•¿åº¦
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">buf</span>      <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span> <span style="color:#75715e">// æŒ‡å‘ å¾ªç¯é˜Ÿåˆ—çš„æŒ‡é’ˆ
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">elemsize</span> <span style="color:#66d9ef">uint16</span>					<span style="color:#75715e">// chan ä¸­å…ƒç´ å¤§å°
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">closed</span>   <span style="color:#66d9ef">uint32</span>					<span style="color:#75715e">// æ˜¯å¦å…³é—­çš„çŠ¶æ€ä½
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">elemtype</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span> 				<span style="color:#75715e">// å…ƒç´ ç±»å‹
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">sendx</span>    <span style="color:#66d9ef">uint</span>   				<span style="color:#75715e">// å·²å‘é€å…ƒç´ åœ¨å¾ªç¯é˜Ÿåˆ—ä¸­çš„ç´¢å¼•
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">recvx</span>    <span style="color:#66d9ef">uint</span>   				<span style="color:#75715e">// å·²æ¥å—å…ƒç´ åœ¨å¾ªç¯é˜Ÿåˆ—ä¸­çš„ç´¢å¼•
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">recvq</span>    <span style="color:#a6e22e">waitq</span>  				<span style="color:#75715e">// ç­‰å¾…æ¥å—æ•°æ®çš„ goroutine é˜Ÿåˆ—
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">sendq</span>    <span style="color:#a6e22e">waitq</span>  				<span style="color:#75715e">// ç­‰å¾…å‘é€æ•°æ®çš„ goroutine åˆ—é˜Ÿ
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">lock</span> <span style="color:#a6e22e">mutex</span>	<span style="color:#75715e">// ä¿æŠ¤ä¸Šè¿°å­—æ®µ
</span><span style="color:#75715e"></span>}

</code></pre></div><ul>
<li><code>buf</code>: channel æµåŠ¨çš„ç¼“å†²åŒºï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘å¾ªç¯é˜Ÿåˆ—çš„æŒ‡é’ˆï¼Œæ•°æ®æœ‰æ— ç¼“å†²çš„ channel çš„åŒºåˆ«åœ¨è¿™ã€‚æ— ç¼“å†²çš„ channel å³è¿™ä¸ª buf åœ¨åˆå§‹åŒ–æ—¶æ²¡æœ‰åˆ†é…å†…å­˜ã€‚</li>
<li><code>recvq</code> ä¸ <code>sendq</code>: é˜»å¡çš„ goroutine é“¾è¡¨ï¼Œåˆ†åˆ«æ˜¯ç­‰å¾…æ¥å—å’Œç­‰å¾…å‘é€æ•°æ®çš„ goroutine é“¾è¡¨</li>
<li>å…¶å®ƒå­—æ®µåŸºæœ¬æ˜¯æè¿° buf çŠ¶æ€çš„ï¼šå¦‚ buf å®¹é‡(<code>dataqsiz</code>)ï¼Œbuf å…·æœ‰çš„å…ƒç´ ä¸ªæ•°(<code>qcount</code>)ï¼Œbuf ä¸­ä¸€ä¸ªå…ƒç´ æ‰€å å†…å­˜å¤§å°ï¼ˆ<code>elemsize</code>ï¼‰ï¼Œ<code>sendx</code> ä¸ <code>recvx</code>æè¿° buf å¾ªç¯æ•°ç»„ä¸­å¯å‘channelå‘é€æ¶ˆæ¯ä¸æ¥å—channel ä¸­æ¶ˆæ¯çš„ç´¢å¼•ä½ç½® &hellip;</li>
</ul>
<p>é™„ä¸Šä¸€ä¸ª channel ç»“æ„çš„ç½‘å›¾ä¾›å‚è€ƒ</p>
<p><p class="markdown-image">
  <img src="https://user-images.githubusercontent.com/7698088/61179068-806ee080-a62d-11e9-818c-16af42025b1b.png" alt="æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹channel - Stefno - åšå®¢å›­"  />
</p></p>
<h3 id="å‘-channel-å‘é€æ¶ˆæ¯">å‘ channel å‘é€æ¶ˆæ¯ <a href="#%e5%90%91-channel-%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af" class="anchor">ğŸ”—</a></h3><ul>
<li><code>ch &lt;- num</code></li>
</ul>
<p>ä¸€èˆ¬çš„å‘ channel å‘é€æ¶ˆæ¯æµç¨‹å¦‚ä¸‹å›¾:</p>
<p><p class="markdown-image">
  <img src="http://ganghuan.oss-cn-shenzhen.aliyuncs.com/img/mermaid-diagram-20211130230713-2021-11-30.png" alt="mermaid-diagram-20211130230713"  />
</p></p>
<blockquote>
<p>å½“ç„¶å®é™…ä»£ç ç¨å¾®å¤æ‚ä¸€äº›ï¼šåœ¨ channel ä¸ <code>select</code>,<code>case</code> ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œcase è¯­å¥éœ€è¦å³æ—¶æ”¶åˆ°è¿”å›å€¼ï¼Œä¸èƒ½é˜»å¡ç­‰å¾…ã€‚å› æ­¤éœ€è¦ä¸€ä¸ªéé˜»å¡çš„æ¨¡å¼ï¼Œåœ¨ channel ä¸º full æ—¶ï¼Œä¸ç­‰å¾…ç›´æ¥è¿”å›ç»“æœã€‚</p>
</blockquote>
<p>ç›´æ¥ä¸Šä»£ç ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒåŸºæœ¬æ˜¯å…¥é˜Ÿå‡ºé˜Ÿæ“ä½œï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// src/runtime/chan.go
</span><span style="color:#75715e"></span><span style="color:#a6e22e">ep</span> <span style="color:#a6e22e">æ˜¯å‘é€æ•°æ®çš„æŒ‡é’ˆ</span>, <span style="color:#a6e22e">block</span> <span style="color:#a6e22e">è¡¨ç¤ºæ˜¯å¦å¯ä»¥æŠŠå½“å‰åç¨‹é˜»å¡</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">æ”¾åˆ°</span> <span style="color:#a6e22e">sendq</span> <span style="color:#a6e22e">é˜Ÿåˆ—</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">åŒæ­¥ç­‰å¾…ç»“æœ</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ä¸€èˆ¬éƒ½æ˜¯true</span><span style="color:#960050;background-color:#1e0010">ã€‚</span><span style="color:#a6e22e">åªæœ‰</span> <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">æ—¶</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ä¸é˜»å¡åç¨‹</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ç›´æ¥è¿”å›</span><span style="color:#960050;background-color:#1e0010">ã€‚</span><span style="color:#a6e22e">è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸå‘é€æ•°æ®</span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">chansend</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">hchan</span>, <span style="color:#a6e22e">ep</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>, <span style="color:#a6e22e">block</span> <span style="color:#66d9ef">bool</span>, <span style="color:#a6e22e">callerpc</span> <span style="color:#66d9ef">uintptr</span>) <span style="color:#66d9ef">bool</span> {
  <span style="color:#75715e">// channel ä¸º nil
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
    <span style="color:#75715e">// select éé˜»å¡ï¼Œç›´æ¥è¿”å› false
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">block</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
		}
    <span style="color:#75715e">// é˜»å¡åç¨‹
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">gopark</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">waitReasonChanSendNilChan</span>, <span style="color:#a6e22e">traceEvGoStop</span>, <span style="color:#ae81ff">2</span>)
		<span style="color:#a6e22e">throw</span>(<span style="color:#e6db74">&#34;unreachable&#34;</span>)
	}
  <span style="color:#75715e">// çœç•¥ä¸€äº›...
</span><span style="color:#75715e"></span>  
  <span style="color:#75715e">// select éé˜»å¡,å¦‚æœ channel æ²¡æœ‰å…³é—­, channel ä¸º fullï¼šæœ‰ç¼“å†²ï¼ˆbuf æ»¡äº†ï¼‰ï¼Œæ— ç¼“å†²ï¼ˆrecvq ä¸ºç©ºï¼‰
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">block</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">closed</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">full</span>(<span style="color:#a6e22e">c</span>) {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
	}
  <span style="color:#75715e">// ... çœç•¥äº†ä¸€äº›...
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// å¦‚æœ channel å…³é—­äº†ï¼Œpanic
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">closed</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)
		panic(<span style="color:#a6e22e">plainError</span>(<span style="color:#e6db74">&#34;send on closed channel&#34;</span>))
	}
  <span style="color:#75715e">// è‹¥ receq ä¸ä¸ºç©ºï¼ŒæŠŠ receq é˜Ÿåˆ—å–ä¸€ä¸ª goroutineï¼Œç›´æ¥æŠŠå…¶è¦å‘é€çš„æ¶ˆæ¯epå‘åˆ°å–åˆ°çš„ goroutine ä¸­ã€‚å­˜åœ¨ä¸¤ç§æƒ…å†µ
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 1. è¿™æ˜¯æ— ç¼“å†² channelå‘é€æ•°æ®çš„è¿‡ç¨‹ï¼Œ
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 2. æœ‰ç¼“å†² channel receq ä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜å…¶ buf æ•°ç»„ä¸ºç©ºï¼Œ
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvq</span>.<span style="color:#a6e22e">dequeue</span>(); <span style="color:#a6e22e">sg</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">sg</span>, <span style="color:#a6e22e">ep</span>, <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>) }, <span style="color:#ae81ff">3</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
	}
  <span style="color:#75715e">// æœ‰ç¼“å†² channelï¼Œä¸”å…¶ buff æ•°ç»„è¿˜æ²¡æ»¡ï¼ŒæŠŠ ep æ•°æ®æ”¾åˆ° buf ä¸­
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">qcount</span> &lt; <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">dataqsiz</span> {
		<span style="color:#75715e">// è¿”å›sendx æŒ‡å‘çš„åœ°å€
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">qp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">chanbuf</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendx</span>)
    <span style="color:#75715e">// æŠŠ ep ä¸­çš„æ¶ˆæ¯ copy åˆ° buf ä¸­
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">typedmemmove</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">elemtype</span>, <span style="color:#a6e22e">qp</span>, <span style="color:#a6e22e">ep</span>)
    <span style="color:#75715e">// sendx count... çš„ä¿®æ”¹
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendx</span><span style="color:#f92672">++</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendx</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">dataqsiz</span> {
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendx</span> = <span style="color:#ae81ff">0</span>
		}
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">qcount</span><span style="color:#f92672">++</span>
		<span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
	}
  <span style="color:#75715e">// ä»¥ä¸Šéƒ½ä¸æˆåŠŸï¼Œé˜»å¡å½“å‰åç¨‹
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendq</span>.<span style="color:#a6e22e">enqueue</span>(<span style="color:#a6e22e">mysg</span>)	<span style="color:#75715e">// å½“å‰åç¨‹å…¥é˜Ÿ sendq
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gopark</span>(<span style="color:#a6e22e">chanparkcommit</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>), <span style="color:#a6e22e">waitReasonChanSend</span>, <span style="color:#a6e22e">traceEvGoBlockSend</span>, <span style="color:#ae81ff">2</span>)	<span style="color:#75715e">// é˜»å¡
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>}
</code></pre></div><p>è¿™é‡Œè§£é‡Šä¸‹ full/empty channelã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">Channel ç±»å‹</th>
<th style="text-align:center">Full</th>
<th style="text-align:center">Empty</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">æ— ç¼“å†²</td>
<td style="text-align:center">reveq é˜Ÿåˆ—ä¸ºç©ºï¼šæ²¡æœ‰ç­‰å¾…æ¥å—æ¶ˆæ¯çš„åç¨‹</td>
<td style="text-align:center">sendq é˜Ÿåˆ—ä¸ºç©ºï¼šæ²¡æœ‰ç­‰å¾…å‘é€æ¶ˆæ¯çš„åç¨‹</td>
</tr>
<tr>
<td style="text-align:center">æœ‰ç¼“å†²</td>
<td style="text-align:center">buf æ•°ç»„å·²æ»¡</td>
<td style="text-align:center">buf æ•°ç»„ä¸ºç©º</td>
</tr>
</tbody>
</table>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>æ— ç¼“å†² channel å‘é€æ¶ˆæ¯æ˜¯<strong>ç›´æ¥å°†æ¶ˆæ¯ä»å‘é€è€…çš„æ ˆæ‹·è´åˆ°æ¥æ”¶è€…çš„æ ˆ</strong></li>
<li>æœ‰ç¼“å†² channelå‘é€æ¶ˆæ¯æ˜¯<strong>å°†æ¶ˆæ¯æ‹·è´åˆ° channel buf ä¸­</strong></li>
</ul>
<h3 id="ä»-channel-ä¸­æ¥å—æ¶ˆæ¯">ä» channel ä¸­æ¥å—æ¶ˆæ¯ <a href="#%e4%bb%8e-channel-%e4%b8%ad%e6%8e%a5%e5%8f%97%e6%b6%88%e6%81%af" class="anchor">ğŸ”—</a></h3><ul>
<li><code>num &lt;- ch</code></li>
<li><code>num,ok &lt;- ch</code>
ç¬¬äºŒä¸ªå¸ƒå°”è¿”å›å€¼ä»£è¡¨ç€è¿™æ¬¡é€šä¿¡æ˜¯å¦æˆåŠŸï¼Œåªæœ‰å½“ channel æ˜¯å…³é—­çŠ¶æ€å¹¶ä¸” channel æ˜¯ Empty æ‰è¿”å› falseï¼Œä¹Ÿå°±æ˜¯è¯´å³ä½¿channel å·²ç»å…³é—­ï¼Œä½†å¦‚æœå…¶è¿˜æœ‰æ¶ˆæ¯åœ¨ buf ä¸­ï¼Œè¿”å›çš„å¸ƒå°”å€¼æ˜¯ trueã€‚</li>
</ul>
<p>å‘ channel æ¥å—æ¶ˆæ¯çš„æµç¨‹ä¸å‘é€æ¶ˆæ¯ç±»ä¼¼ï¼Œæ•´ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<blockquote>
<p>æ­¤ç¤ºæ„å›¾ä¹Ÿçœç•¥äº†è€ƒè™‘ä¸é˜»å¡çš„åœºæ™¯ï¼ˆä¸<code>select</code> ,<code>case</code>ï¼‰</p>
</blockquote>
<p><p class="markdown-image">
  <img src="http://ganghuan.oss-cn-shenzhen.aliyuncs.com/img/image-20211130231739724-2021-11-30.png" alt="image-20211130231739724"  />
</p></p>
<p>ä»£ç è¯¦æƒ…å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// ep: æ¥å—æ•°æ®ï¼Œblockï¼šæ˜¯å¦é˜»å¡å¼æ¥å—, selected: æ˜¯å¦æœ‰è¿”å›å€¼(select è¯­å¥ å¹¶ä¸” channel empty æ— è¿”å›å€¼) received: æ­¤è¿”å›å€¼æ˜¯å¦æ˜¯æ­£å¸¸ç”±å‘é€è€…å‘é€è¿‡æ¥çš„æ•°æ®
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">chanrecv</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">hchan</span>, <span style="color:#a6e22e">ep</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>, <span style="color:#a6e22e">block</span> <span style="color:#66d9ef">bool</span>) (<span style="color:#a6e22e">selected</span>, <span style="color:#a6e22e">received</span> <span style="color:#66d9ef">bool</span>) {
  <span style="color:#75715e">// channel ä¸ºç©º
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
    <span style="color:#75715e">// éé˜»å¡ç›´æ¥è¿”å› false false
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">block</span> {
			<span style="color:#66d9ef">return</span>
		}
    <span style="color:#75715e">// é˜»å¡åç¨‹
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">gopark</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">waitReasonChanReceiveNilChan</span>, <span style="color:#a6e22e">traceEvGoStop</span>, <span style="color:#ae81ff">2</span>)
		<span style="color:#a6e22e">throw</span>(<span style="color:#e6db74">&#34;unreachable&#34;</span>)
	}

	<span style="color:#75715e">// éé˜»å¡å¿«é€Ÿå¤±è´¥
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">block</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">empty</span>(<span style="color:#a6e22e">c</span>) {
		<span style="color:#75715e">// channel æ²¡æœ‰å…³é—­ï¼Œè¿”å› false,false
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">Load</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">closed</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
			<span style="color:#66d9ef">return</span>
		}
    <span style="color:#75715e">// channel å·²ç»å…³é—­, éœ€è¦è¿”å›é›¶å€¼ï¼Œå› æ­¤è¿”å›:trueï¼Œfalse
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">empty</span>(<span style="color:#a6e22e">c</span>) {
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ep</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
				<span style="color:#a6e22e">typedmemclr</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">elemtype</span>, <span style="color:#a6e22e">ep</span>)
			}
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>, <span style="color:#66d9ef">false</span>
		}
	}
	<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// å¾—æ“ä½œ buf æˆ–è€… sendq é˜Ÿåˆ—äº†ï¼Œå¹¶å‘éœ€è¦åŠ é”
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">lock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)

  <span style="color:#75715e">// å¦‚æœ channel å·²ç»å…³é—­, å¹¶ä¸” buf ä¸ºç©ºï¼Œè¿”å›é›¶å€¼
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">closed</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">qcount</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ep</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">typedmemclr</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">elemtype</span>, <span style="color:#a6e22e">ep</span>)
		}
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>, <span style="color:#66d9ef">false</span>
	}

  <span style="color:#75715e">// å‘é€é˜Ÿåˆ—ä¸ä¸ºç©º, æœ‰ä¸¤ç§æƒ…å†µsendq ä¸ä¸ºç©º 
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 1. æ— ç¼“å†² channelï¼Œç›´æ¥å°†é˜Ÿé¦–çš„æ¶ˆæ¯ copy åˆ° ep æŒ‡å‘çš„æ•°æ®ä¸­
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// 2. æœ‰ç¼“å†² channelï¼Œä½†æ˜¯å…¶ buf å·²æ»¡ã€‚å…¶ä¸­æ“ä½œéœ€è¦æŠŠ buf é˜Ÿé¦–æ•°æ® copy åˆ° ep æŒ‡å‘çš„æ•°æ®ï¼Œ sendq é˜Ÿé¦–å‡ºé˜Ÿï¼Œå°†å…¶å‘é€çš„æ¶ˆæ¯copy åˆ° buf ä¸­
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">sg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">sendq</span>.<span style="color:#a6e22e">dequeue</span>(); <span style="color:#a6e22e">sg</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">recv</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">sg</span>, <span style="color:#a6e22e">ep</span>, <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>) }, <span style="color:#ae81ff">3</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>, <span style="color:#66d9ef">true</span>
	}
 
	<span style="color:#75715e">// buf ä¸ä¸ºç©ºï¼Œå°† buf é˜Ÿé¦–æ•°æ® copy åˆ° ep 
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">qcount</span> &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#75715e">// Receive directly from queue
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">qp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">chanbuf</span>(<span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvx</span>)
		<span style="color:#75715e">// ....
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ep</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">typedmemmove</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">elemtype</span>, <span style="color:#a6e22e">ep</span>, <span style="color:#a6e22e">qp</span>)
		}
		<span style="color:#a6e22e">typedmemclr</span>(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">elemtype</span>, <span style="color:#a6e22e">qp</span>)
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvx</span><span style="color:#f92672">++</span>
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvx</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">dataqsiz</span> {
			<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvx</span> = <span style="color:#ae81ff">0</span>
		}
		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">qcount</span><span style="color:#f92672">--</span>
		<span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>, <span style="color:#66d9ef">true</span>
	}
	<span style="color:#75715e">// éé˜»å¡ç›´æ¥è¿”å›
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">block</span> {
		<span style="color:#a6e22e">unlock</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">false</span>
	}

	<span style="color:#75715e">// é˜»å¡
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">gp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getg</span>()
	<span style="color:#a6e22e">mysg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">acquireSudog</span>()
	<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">recvq</span>.<span style="color:#a6e22e">enqueue</span>(<span style="color:#a6e22e">mysg</span>)			<span style="color:#75715e">// å…¥ recvq é˜Ÿ
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">gopark</span>(<span style="color:#a6e22e">chanparkcommit</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">lock</span>), <span style="color:#a6e22e">waitReasonChanReceive</span>, <span style="color:#a6e22e">traceEvGoBlockRecv</span>, <span style="color:#ae81ff">2</span>)	<span style="color:#75715e">// é˜»å¡
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">success</span>
}
</code></pre></div><p><strong>æ€»ç»“</strong></p>
<ul>
<li>å¯ä»¥å‘ closed channel æ¥å—å€¼ï¼Œè‹¥å…¶ buf ä¸ºç©ºï¼Œåˆ™è¿”å›é›¶å€¼ã€‚è‹¥å…¶ buf ä¸ä¸ºç©ºï¼Œæ­£å¸¸è¿”å›</li>
<li>æ— ç¼“å†² channel æ¥å—æ¶ˆæ¯ï¼Œæ˜¯ç”±å¦ä¸€ä¸ª goroutine é‡Œçš„æ ˆç›´æ¥æ‹·è´è¿‡æ¥çš„</li>
<li>æœ‰ç¼“å†² channel æ€»æ˜¯å– buf é˜Ÿé¦–æ¶ˆæ¯ï¼Œä½†å¦‚æœ sendq ä¸ä¸ºç©ºï¼Œè¿˜éœ€è¦æŠŠ sendq éœ€è¦å‘é€çš„æ¶ˆæ¯æ‹·è´åˆ° buf ä¸­</li>
</ul>
<h2 id="channel-vs-mutex">channel vs mutex <a href="#channel-vs-mutex" class="anchor">ğŸ”—</a></h2><blockquote>
<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>
</blockquote>
<p>ä¸Šè¿°æ€æƒ³å®é™…ä¸Šå°±æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­çš„ <strong>å…±äº«å†…å­˜æ¨¡å‹</strong> VS <strong>CSP ä¿¡æ¯ä¼ é€’æ¨¡å‹</strong>ï¼Œæ›´å…·ä½“çš„è¯´ï¼š <strong>mutex</strong> VS <strong>channel</strong>ï¼ŒGo æ˜¯ç¬¬ä¸€ä¸ªå¼•å…¥ CSP æ€æƒ³å¹¶ä¸”å‘æ‰¬å…‰å¤§çš„è¯­è¨€ã€‚é‚£è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­è¦æ‘’å¼ƒ mutexï¼Œå…¨éƒ¨ä½¿ç”¨ channel å‘¢ï¼Ÿæ—¢ç„¶ Go è®¾è®¡è€…è¿™ä¹ˆæ¨å´‡ CSPï¼Œ ä¸ºä»€ä¹ˆ Go ä¸­è¿˜æ˜¯æœ‰ mutex åŒ…å‘¢ï¼Ÿ</p>
<p>channel ä¸ mutex ä¾§é‡ç‚¹ä¸ä¸€æ ·ï¼Œchannel ä¾§é‡äºåç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œmutex ç”¨æ¥ä¿æŠ¤å¹¶å‘æ•°æ®</p>
<p>é€‚ç”¨äº channel çš„åœºæ™¯ï¼š</p>
<ol>
<li>ä¼ é€’æ•°æ®çš„æ‰€æœ‰æƒï¼Œå³æŠŠæŸä¸ªæ•°æ®å‘é€ç»™å…¶ä»–åç¨‹</li>
<li>åˆ†å‘ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªæ•°æ®</li>
<li>äº¤æµå¼‚æ­¥ç»“æœï¼Œç»“æœæ˜¯ä¸€ä¸ªæ•°æ®</li>
</ol>
<p>é€‚ç”¨äº mutex çš„åœºæ™¯ï¼š</p>
<ol>
<li>ç¼“å­˜</li>
<li>çŠ¶æ€</li>
</ol>
<p>å®é™…ä¸Šï¼Œchannel çš„åº•å±‚æ•°æ®ç»“æ„ä¸­ä¹Ÿåˆ©ç”¨ mutex ä¿æŠ¤æ•°æ®ï¼Œä½†æ˜¯é€‚ç”¨äº mutex çš„åœºæ™¯å»ä½¿ç”¨ channel æ€§èƒ½ä¼šå·®ä¸€äº›ã€‚</p>
<p>æ›´å…·ä½“çš„æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸‹å›¾è¿›è¡Œåˆ¤æ–­</p>
<p><p class="markdown-image">
  <img src="http://ganghuan.oss-cn-shenzhen.aliyuncs.com/img/2de7743a1386dec3af56f6903af7bfde_482x309-2021-11-30.png" alt="img"  />
</p></p>
<p><strong>channel å®é™…åœºæ™¯</strong></p>
<ol>
<li>è¶…æ—¶æ§åˆ¶/å®šæ—¶ä»»åŠ¡</li>
<li>å¹¶å‘æ§åˆ¶</li>
<li>è§£è€¦ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…</li>
<li>&hellip;</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<ol>
<li>channel ä¸æ˜¯é“¶å¼¹ï¼Œè¯¥ç”¨ mutex å°±ç”¨ mutex</li>
<li>channnel ç”¨äºå…³æ³¨æ•°æ®æµåŠ¨ï¼Œmutex ä¿æŠ¤å›ºå®šæ•°æ®</li>
</ol>
<h2 id="å‚è€ƒ">å‚è€ƒ <a href="#%e5%8f%82%e8%80%83" class="anchor">ğŸ”—</a></h2><ol>
<li><a href="https://github.com/golang/go/blob/5786a54cfe34069c865fead1b6d9c9e3485a40a5/src/runtime/chan.go" target="_blank" rel="noopener">https://github.com/golang/go/blob/5786a54cfe34069c865fead1b6d9c9e3485a40a5/src/runtime/chan.go</a></li>
<li><a href="https://www.bookstack.cn/read/qcrao-Go-Questions/channel-%E4%BB%80%E4%B9%88%E6%98%AF%20CSP.md" target="_blank" rel="noopener">https://www.bookstack.cn/read/qcrao-Go-Questions/channel-%E4%BB%80%E4%B9%88%E6%98%AF%20CSP.md</a></li>
<li><a href="https://www.cnblogs.com/qcrao-2018/p/11220651.html" target="_blank" rel="noopener">https://www.cnblogs.com/qcrao-2018/p/11220651.html</a></li>
</ol>

    </div>

    
        <div class="tags">
            
                <a href="https://he2121.github.io/xiaohe-blog/tags/golang">golang</a>
            
        </div>
    
    
    

</section>

<script src="https://utteranc.es/client.js"
        repo="he2121/xiaohe-blog"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/he2121/" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
       Â© Copyright 
       2021 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       å°è´º
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
