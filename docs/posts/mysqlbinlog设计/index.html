<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <title>MySQL binlog 设计介绍 | 小贺的博客</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="通过这篇文章你能了解到的知识 🔗 binlog是什么 binlog 的作用 binlog 的三种类型，以及各自优缺点 binlog 文件的结构与内容  binlog 是什么 🔗Binary Log，顾名思义是一种二进制格式日志。具体来说，binlog 日志是一组包含了对 MySQL server 实例进行数据修改（update/delete/insert/...）信息的文件。
binlog 作用 🔗 用于复制，主从复制 某些数据恢复操作需要使用 binlog  binlog 类型 🔗 **基于语句 (Statement-based) **的日志记录 (SBL): 事件包含产生数据变化的SQL语句。 基于行 (Row-based) 的日志记录(RBL): 描述单个行的变化 混合 (Mixed)：上述两者结合使用, 以 SBL 为主，特殊情况下切换到 RBL  binlog 为什么会有这三种类型？
一开始只有 statement-based，但 statement-based 存在不少问题，后面才有的 row-base与 mixed。
SBL 优点 🔗 产生的日志文件少，减少 io 次数  SBL 缺点 🔗  在一些不安全的语句上，主从复制做不到数据一致，比如
  含有系统函数的语句，可能会在副本上返回不同的值，如 RAND(), USER(),UUID(), SYSDATE() .">
<meta name="generator" content="Hugo 0.89.2" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/xiaohe-blog/css/style.css">



<link rel="shortcut icon" href="/xiaohe-blog/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-FY1WNXTY3L', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/xiaohe-blog/"> <span class="arrow">←</span></a>
	
	<a href="/xiaohe-blog/posts"></a>
	<a href="/xiaohe-blog/tags"></a>
	<a href="/xiaohe-blog/about"></a>

	
		<a href="/xiaohe-blog/tags">tag</a>
	
		<a href="/xiaohe-blog/%e7%ae%97%e6%b3%95">算法</a>
	
		<a href="/xiaohe-blog/%e5%bb%ba%e7%ab%99">建站</a>
	
		<a href="/xiaohe-blog/%e6%9d%82%e8%b0%88">杂谈</a>
	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">MySQL binlog 设计介绍</h1>

    <div class="tip">
        <time datetime="2021-11-10 18:33:24 &#43;0800 CST"></time>
        <span class="split">
          ·
        </span>
        <span>
          
        </span>
        <span class="split">
          ·
        </span>
        <span>
          
        </span>
    </div>

    
    


    <div class="content">
      <h2 id="通过这篇文章你能了解到的知识">通过这篇文章你能了解到的知识 <a href="#%e9%80%9a%e8%bf%87%e8%bf%99%e7%af%87%e6%96%87%e7%ab%a0%e4%bd%a0%e8%83%bd%e4%ba%86%e8%a7%a3%e5%88%b0%e7%9a%84%e7%9f%a5%e8%af%86" class="anchor">🔗</a></h2><ul>
<li><code>binlog</code>是什么</li>
<li><code>binlog</code> 的作用</li>
<li><code>binlog</code> 的三种类型，以及各自优缺点</li>
<li><code>binlog</code>  文件的结构与内容</li>
</ul>
<h2 id="binlog-是什么"><code>binlog</code> 是什么 <a href="#binlog-%e6%98%af%e4%bb%80%e4%b9%88" class="anchor">🔗</a></h2><p><code>Binary Log</code>，顾名思义是一种二进制格式日志。具体来说，<code>binlog</code> 日志是一组包含了对 <strong>MySQL server</strong> 实例进行数据修改（<code>update/delete/insert/...</code>）信息的文件。</p>
<h2 id="binlog-作用">binlog 作用 <a href="#binlog-%e4%bd%9c%e7%94%a8" class="anchor">🔗</a></h2><ul>
<li>用于复制，主从复制</li>
<li>某些数据恢复操作需要使用 <code>binlog</code></li>
</ul>
<h2 id="binlog-类型">binlog 类型 <a href="#binlog-%e7%b1%bb%e5%9e%8b" class="anchor">🔗</a></h2><ol>
<li>**基于语句 (<code>Statement-based</code>) **的日志记录 (<code>SBL</code>):  事件包含产生数据变化的SQL语句。</li>
<li><strong>基于行 (<code>Row-based</code>)</strong> 的日志记录(<code>RBL</code>): 描述单个行的变化</li>
<li><strong>混合 (<code>Mixed</code>)</strong>：上述两者结合使用, 以 <code>SBL</code> 为主，特殊情况下切换到 <code>RBL</code></li>
</ol>
<p>binlog 为什么会有这三种类型？</p>
<p>一开始只有 <code>statement-based</code>，但 <code>statement-based</code> 存在不少问题，后面才有的 <code>row-base</code>与 <code>mixed</code>。</p>
<h3 id="sbl-优点"><code>SBL</code> 优点 <a href="#sbl-%e4%bc%98%e7%82%b9" class="anchor">🔗</a></h3><ul>
<li>产生的日志文件少，减少 io 次数</li>
</ul>
<h3 id="sbl-缺点"><code>SBL</code> 缺点 <a href="#sbl-%e7%bc%ba%e7%82%b9" class="anchor">🔗</a></h3><ul>
<li>
<p>在一些<strong>不安全的语句上</strong>，主从复制做不到数据一致，比如</p>
<ol>
<li>
<p>含有系统函数的语句，可能会在副本上返回不同的值，如 <code>RAND(), USER(),UUID(), SYSDATE() ....</code></p>
</li>
<li>
<p>更新一个有 <code>AUTO_INCREMENT</code> 列的表</p>
</li>
<li>
<p>Updates using LIMIT</p>
</li>
<li>
<p>&hellip;</p>
</li>
</ol>
</li>
<li>
<p>慢 SQL 也会在副本中再执行一次</p>
</li>
</ul>
<h3 id="rbl-优点"><code>RBL</code> 优点 <a href="#rbl-%e4%bc%98%e7%82%b9" class="anchor">🔗</a></h3><ul>
<li>这是最安全的复制形式</li>
<li>在INSERT、UPDATE或DELETE语句中，副本需要更少的行锁。</li>
</ul>
<h3 id="rbl-缺点"><code>RBL 缺点</code> <a href="#rbl-%e7%bc%ba%e7%82%b9" class="anchor">🔗</a></h3><ul>
<li><code>RBL</code> 日志文件更大</li>
</ul>
<h3 id="总结">总结 <a href="#%e6%80%bb%e7%bb%93" class="anchor">🔗</a></h3><p>推荐使用 <code>RBL</code>，利大于弊，最新 MySQL 版本默认也是使用 <code>RBL</code>。</p>
<h2 id="binlog-结构"><code>binlog</code> 结构 <a href="#binlog-%e7%bb%93%e6%9e%84" class="anchor">🔗</a></h2><h2 id="课后题">课后题 <a href="#%e8%af%be%e5%90%8e%e9%a2%98" class="anchor">🔗</a></h2><ol>
<li>主从复制，采取的是 push 模式还是 pull 模式</li>
<li>MySQL binlog 为什么不默认使用 Mixed 模式</li>
<li>在使用<code>RBL</code>前提下 ，DDL（CREATE/ALTER） 语句怎么记录</li>
<li>使用 <code>NOW()</code>的语句是不安全么（<code>SBL</code>主从复制  ）</li>
<li><code>binlog</code> 与 <code>redo log</code> 区别</li>
</ol>
<h2 id="参考">参考 <a href="#%e5%8f%82%e8%80%83" class="anchor">🔗</a></h2><ol>
<li>
<p><a href="https://dev.mysql.com/doc/internals/en/binary-log-overview.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/internals/en/binary-log-overview.html</a></p>
</li>
<li>
<p><a href="http://mysql.taobao.org/monthly/2018/08/01/" target="_blank" rel="noopener">http://mysql.taobao.org/monthly/2018/08/01/</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/33504555" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/33504555</a></p>
</li>
</ol>

    </div>

    
        <div class="tags">
            
                <a href="https://he2121.github.io/xiaohe-blog/tags/mysql">MySQL</a>
            
                <a href="https://he2121.github.io/xiaohe-blog/tags/binlog">binlog</a>
            
                <a href="https://he2121.github.io/xiaohe-blog/tags/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
            
        </div>
    
    
    
  <div id="comment">
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "heganghuan-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/he2121/" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
       © Copyright 
       2021 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       小贺
    
    </div>

    
      <div class="powerby">
        
      </div>
    
</footer>



  </body>
</html>
